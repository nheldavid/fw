<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleurop Order Information</title>
    
    <!-- Freshworks Crayons Design System - Official UI Components -->
    <!-- ES Module version for modern browsers -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.esm.js"></script>
    <!-- Fallback for older browsers -->
    <script nomodule src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.js"></script>
    <!-- Crayons CSS with design tokens and component styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/css/crayons.css">
    
    <!-- Custom styles for app-specific layout -->
    <link rel="stylesheet" href="styles/style.css">
    
    <!-- Freshworks App SDK - Required for Freshdesk integration -->
    <script src="{{{appclient}}}"></script>
  </head>

  <body>
    <!-- Main application container -->
    <div id="app">
      <!-- Sidebar container - fits within Freshdesk ticket sidebar -->
      <div class="sidebar-container">
        <!-- App header with title -->
        <header class="sidebar-header">
          <fw-label value="Fleurop Order Information" color="blue" size="large"></fw-label>
        </header>
        
        <!-- Main content area with different states -->
        <main class="sidebar-content">
          <!-- Loading State - shown while fetching data from Freshdesk API -->
          <div id="loading-state" class="loading-container">
            <fw-spinner size="medium"></fw-spinner>
            <fw-label value="Loading order information..." color="text-secondary"></fw-label>
          </div>
          
          <!-- Error State - shown when API calls fail or data is invalid -->
          <div id="error-state" class="error-container" style="display: none;">
            <fw-icon name="alert-triangle" color="warning" size="24"></fw-icon>
            <fw-label value="Unable to load order information" color="text-primary" size="large"></fw-label>
            <fw-label value="Please check your connection and try again." color="text-secondary"></fw-label>
            <fw-button id="retry-btn" color="primary" size="small">
              <fw-icon name="refresh" slot="before-label"></fw-icon>
              Retry
            </fw-button>
          </div>

          <div style="display: none;">
            <fw-button id="update-btn" color="secondary" size="small" onclick="extractCustomObjectData()">
              <fw-icon name="refresh" slot="before-label"></fw-icon>
            </fw-button>
            <fw-button id="expand-btn" color="secondary" size="small" onclick="">Recipient
              <fw-icon name="open-new-tab" slot="before-label"></fw-icon>
            </fw-button>
            <fw-button id="copy-btn" color="secondary" size="small" onclick="showExecution()">Execution
              <fw-icon name="open-new-tab" slot="before-label"></fw-icon>
            </fw-button>
          </div>
          
          <!-- No Data State - shown when no order information is available -->
          <!-- Content Container - shown when data is successfully loaded -->
          <div id="content-container" style="display: none;">
            <!-- Customer Information Section - displays customer-related data -->
            <fw-card class="info-section">
              <!-- <fw-label value="Customer Information" color="text-primary" size="large" slot="card-header"></fw-label> -->
              <div class="info-grid">
                <div class="info-item">
                  <fw-label value="Order Number:" color="text-secondary"></fw-label>
                  <!-- Dynamic content: populated from cf_order_number custom field -->
                  <fw-label id="order-number" value="-" color="text-primary"></fw-label>
                </div>
                <div class="info-item">
                  <fw-label value="FDE:" color="text-secondary"></fw-label>
                  <!-- Dynamic content: populated from cf_customer_email custom field -->
                  <fw-label id="fde-order-number" value="-" color="text-primary"></fw-label>
                </div>
                <div class="info-item">
                  <fw-label value="Customer Name:" color="text-secondary"></fw-label>
                  <!-- Dynamic content: populated from cf_customer_name custom field -->
                  <fw-label id="customer-name" value="-" color="text-primary"></fw-label>
                </div>
                <div class="info-item">
                  <fw-label value="Email:" color="text-secondary"></fw-label>
                  <!-- Dynamic content: populated from cf_order_id custom field -->
                  <fw-label id="customer-email" value="-" color="text-primary"></fw-label>
                </div>


                <div class="info-item">
                  <fw-label value="Delivery Date:" color="text-secondary"></fw-label>
                  <!-- Dynamic content: populated from cf_delivery_date custom field -->
                  <fw-label id="delivery-date" value="-" color="text-primary"></fw-label>
                </div>
                <div class="info-item">
                  <fw-label value="Order Status:" color="text-secondary"></fw-label>
                  <!-- Dynamic content: populated from cf_order_date custom field -->
                  <!-- <fw-label id="order-status" value="-" color="text-primary" class="status-badge"></fw-label> -->
                  <fw-label id="order-status" value="-" color="success" class="status-badge"></fw-label>
                </div>                
                
                <!-- <div class="info-item">
                  <fw-button color="link" size="icon">
                    <fw-icon name="refresh"></fw-icon>
                  </fw-button>
                </div> -->
              </div>
            </fw-card>

            <fw-accordion id="execution-accordion">
              <fw-button class="title-button" size="small" color="link" onclick="showExecution()">
                <fw-icon name="open-new-tab"></fw-icon>
              </fw-button>
              <fw-accordion-title>
                <fw-icon name="items"></fw-icon>
                <span>Ausführung</span>
                </fw-accordion-title>
              <fw-accordion-body>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="fw-type-xs">Nummer:</span>
                    <div class="fw-type-sm" id="ausfuehrung-nummer">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Name:</span>
                    <div class="fw-type-sm" id="ausfuehrung-name">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Addresse:</span>
                    <div class="fw-type-sm" id="ausfuehrung-addresse">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Rang:</span>
                    <div class="fw-type-sm" id="ausfuehrung-rang">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Fax:</span>
                    <div class="fw-type-sm" id="ausfuehrung-fax">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Telefon:</span>
                    <div class="fw-type-sm" id="ausfuehrung-telefon">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Email:</span>
                    <div class="fw-type-sm" id="ausfuehrung-email">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Auftragshinweis:</span>
                    <div class="fw-type-sm" id="auftragshinweis">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Hinweis:</span>
                    <div class="fw-type-sm" id="hinweis">-</div>
                  </div>
                </div>
              </fw-accordion-body>
            </fw-accordion>

            <fw-accordion id="client-accordion">
              <fw-button class="title-button" size="small" color="link">
                <fw-icon name="open-new-tab"></fw-icon>
              </fw-button>
              <fw-accordion-title>
                <fw-icon name="contact"></fw-icon>
                <span>Auftraggeber</span>
              </fw-accordion-title>
              <fw-accordion-body>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="fw-type-xs">Name:</span>
                    <div class="fw-type-sm" id="auftraggeber-name">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Firmenzusatz:</span>
                    <div class="fw-type-sm" id="auftraggeber-firmenzusatz">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Addresse:</span>
                    <div class="fw-type-sm" id="auftraggeber-addresse">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Telefon:</span>
                    <div class="fw-type-sm" id="auftraggeber-telefon">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Email:</span>
                    <div class="fw-type-sm" id="auftraggeber-email">-</div>
                  </div>
                </div>
              </fw-accordion-body>
            </fw-accordion>
            
            <fw-accordion id="recipient-accordion">
              <fw-button class="title-button" size="small" color="link" onclick="showRecipient()">
                <fw-icon name="open-new-tab"></fw-icon>
              </fw-button>
              <fw-accordion-title>
                <fw-icon name="company"></fw-icon>
                <span>Empfänger</span>
              </fw-accordion-title>
              <fw-accordion-body>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="fw-type-xs">Name:</span>
                    <div class="fw-type-sm" id="recipient-name">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Firmenzusatz:</span>
                    <div class="fw-type-sm" id="recipient-firmenzusatz">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Addresse:</span>
                    <div class="fw-type-sm" id="recipient-addresse">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Telefon:</span>
                    <div class="fw-type-sm" id="recipient-telefon">-</div>
                  </div>
                </div>  
              </fw-accordion-body>
            </fw-accordion>

            <fw-accordion id="auftragsstatus-accordion">
              <fw-button class="title-button" size="small" color="link" onclick="showOrderStatus()">
                <fw-icon name="open-new-tab"></fw-icon>
              </fw-button>
              <fw-accordion-title>
                <fw-icon name="products"></fw-icon>
                <span>Auftragsstatus</span>
              </fw-accordion-title>
              <fw-accordion-body>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="fw-type-xs">Bestelldatum:</span>
                    <div class="fw-type-sm" id="bestelldatum">-</div>
                  </div>                  
                  <div class="info-item">
                    <span class="fw-type-xs">Vertriebsweg:</span>
                    <div class="fw-type-sm" id="vertriebsweg">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Status:</span>
                    <div class="fw-type-sm" id="auftragsstatus">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Freitext:</span>
                    <div class="fw-type-sm" id="freitext">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Molliwert:</span>
                    <div class="fw-type-sm" id="molliwert">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Erfassdatum:</span>
                    <div class="fw-type-sm" id="erfassdatum">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Rechnungsnummer:</span>
                    <div class="fw-type-sm" id="rechnungsnummer">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Trackingnummer:</span>
                    <div class="fw-type-sm" id="trackingnummer">-</div>
                  </div>
                </div>
              </fw-accordion-body>
            </fw-accordion>    
            
            <fw-accordion id="vermittler-accordion">
              <fw-button class="title-button" size="small" color="link">
                <fw-icon name="open-new-tab"></fw-icon>
              </fw-button>
              <fw-accordion-title>
                <fw-icon name="groups"></fw-icon>
                <span>Vermittler</span>
              </fw-accordion-title>
              <fw-accordion-body>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="fw-type-xs">Nummer:</span>
                    <div class="fw-type-sm" id="vermittler">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Aktiv:</span>
                    <div class="fw-type-sm" id="vermittler-aktiv">
                      <fw-checkbox checked disabled></fw-checkbox>
                    </div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Typ:</span>
                    <div class="fw-type-sm" id="vermittler-type">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Name:</span>
                    <div class="fw-type-sm" id="vermittler-name">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Addresse:</span>
                    <div class="fw-type-sm" id="vermittler-addresse">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Fax:</span>
                    <div class="fw-type-sm" id="vermittler-fax">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Telefon:</span>
                    <div class="fw-type-sm" id="vermittler-telefon">-</div>
                  </div>
                </div>
              </fw-accordion-body>
            </fw-accordion> 

            <fw-accordion id="warenkorb-accordion">
              <fw-button class="title-button" size="small" color="link">
                <fw-icon name="open-new-tab"></fw-icon>
              </fw-button>
              <fw-accordion-title>
                <fw-icon name="ecommerce"></fw-icon>
                <span>Warenkorb</span>
              </fw-accordion-title>
              <fw-accordion-body>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="fw-type-xs">Auftragsnummer:</span>
                    <div class="fw-type-sm" id="warenkorb-auftragsnummer">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Bestellnummer:</span>
                    <div class="fw-type-sm" id="warenkorb-bestelnummer">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Lierferdatum:</span>
                    <div class="fw-type-sm" id="warenkorb-lierferdatum">-</div>
                  </div>
                  <div class="info-item">
                    <span class="fw-type-xs">Zahlbetrag:</span>
                    <div class="fw-type-sm" id="warenkorb-zahlbetrag">-</div>
                  </div>
                  <fw-data-table id="warenkorb-items" is-selectable="true" label="Data table 1">
                  </fw-data-table>
                  <div class="info-item">
                    <span class="fw-type-xs">Kartentext:</span>
                    <div class="fw-type-sm" id="warenkorb-Kartentext">-</div>
                  </div>
                  <fw-data-table id="warenkorb-positionen" label="Data table 1">
                  </fw-data-table>
                </div>
              </fw-accordion-body>
            </fw-accordion> 
          </div>
        </main>
      </div>
    </div>
    
    <!-- Main application logic - handles Freshdesk API integration and UI updates -->
    <script src="scripts/app.js"></script>
  </body>
</html>
